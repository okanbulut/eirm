---
title: "Explanatory IRT for Dichotomous Data"
author: "Okan Bulut"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
description: >
  How does eirm can be used for estimating dichotomous and polytomous 
  explanatory IRT models in R?
vignette: >
  %\VignetteIndexEntry{Explanatory IRT for Dichotomous Data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
  \usepackage[utf8]{inputenc}
---

```{r setup, echo = TRUE, eval = TRUE, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, message = FALSE, warning = FALSE)
options(width = 800)
```

### Example 1: Rasch model

The Rasch model (i.e., a fully descriptive model) can be estimated using `eirm`. The following example shows how to estimate Rasch item parameters for the verbal aggression data set (see `?VerbAgg` for further details). A preview of the `VerbAgg` data set is shown below:

```{r, echo=FALSE}
library("eirm")
```

```{r}
data("VerbAgg")
head(VerbAgg)
```

To estimate the Rasch model, a regression-like formula must be defined: `formula = "r2 ~ -1 + item + (1|id)"`. In the formula, 

* `r2` is the variable for dichotomous item responses
* `-1` removes the intercept from the model and yields parameter estimates for all items in the data set. With `1` (instead of `-1`), an intercept representing the parameter of the first item and relative parameters for the remaining items (i.e., distance from the parameter of the first item) would be estimated.
* `item`is the variable representing item IDs in the data set
* `(1|id)` refers to the random effects for persons represented by the `id` column in the data set.

The output for the Rasch model is shown below:

```{r, echo = TRUE, eval = FALSE}
mod1 <- eirm(formula = "r2 ~ -1 + item + (1|id)", data = VerbAgg)
print(mod1)
```

By default, the `eirm` function returns the **easiness** parameters because the function uses a regression model parameterization where positive parameters indicate positive association with the dependent variable. In order to print the difficulty parameters (instead of easiness), `print(mod1, difficulty = TRUE)` must be used:

```{r, echo = TRUE, eval = FALSE}
print(mod1, difficulty = TRUE)
```

The `mod1` object is essentially a `glmerMod`-class object from the `lme4` package (Bates, Maechler, Bolker, & Walker (2015)). All `glmerMod` results for the estimated model can seen with `mod1$model`. For example, estimated random effects for persons (i.e., theta estimates) can be obtained using:

```{r, echo = TRUE, eval = FALSE}
theta <- ranef(mod1$model)$id
head(theta)
```

***

### Example 2: Explanatory Models with Item and Person Covariates 

The following example shows how to use item-related and person-related explanatory variables to explain dichotomous responses in the verbal aggression data set. 

```{r, echo = TRUE, eval = TRUE}
mod2a <- eirm(formula = "r2 ~ -1 + situ + btype + mode + (1|id)", data = VerbAgg)

print(mod2a)
```

It is possible to visualize the parameters using an item-person map using `plot(mod2a)`, which returns the following plot. Note that this plot is a modified version of the `plotPImap` function from the `eRm` package). 

```{r, echo = TRUE, eval = FALSE}
plot(mod2a)
```

Aesthetic elements such as axis labels and plot title can be added to the plot. For example, the following code updates the x-axis label and the main plot title (see `?plot.eirm` for further details).

```{r, echo = TRUE, eval = FALSE}
plot(mod2a, difficulty = TRUE, main = "Verbal Aggression Example", latdim = "Verbal Aggression")
```

This plot wpuld show the difficulty parameters (instead of easiness), change the main title above the plot, and change the x-axis -- the name for the latent trait being measured. 

Also, it is possible to compare nested explanatory models with each other. The following example shows the estimation of a more compact version of `mod2a` with one less variable and compares the two models (i.e., `mod2a` vs. `mod2b`).

```{r, echo = TRUE, eval = FALSE}
mod2b <- eirm(formula = "r2 ~ -1 + situ + btype + (1|id)", data = VerbAgg)

anova(mod2a$model, mod2b$model)
```
